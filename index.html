<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<script type="text/javascript">
var xOfTreas = 0;
var yOfTreas = 0;
var scoreClick = 0;
var radiusOfSearch = 10;
var style_win = "background-color:#51b0cc;";
var xOfMouse = 0;
var yOfMouse = 0;
var coordOfMouse = "";
var coordOfTreas = "";
var currentDistance;
var isFound = 0;
var customThreshold = 0.01;
//------------------------------------------------------------------------------
function showCoordMouse()
{
	document.getElementById("mouseCoord_div").innerHTML = coordOfMouse;
}
//------------------------------------------------------------------------------
function showCurrentDistance()
{
	document.getElementById("currentDistance_div").innerHTML = currentDistance;
}
function customEventFunction(event)
{
    var canvas = document.getElementById('game_canvas');
	xOfMouse = event.pageX - canvas.offsetLeft;     // Get the horizontal coordinate
	yOfMouse = event.pageY - canvas.offsetTop;     // Get the vertical coordinate
	coordOfMouse = "X coords: " + xOfMouse + ", Y coords: " + yOfMouse;
	//coordOfTreasure = "X coords: " + xOfTreas + ", Y coords: " + yOfTreas;
	//showCoordMouse();
	drawDistanceBasedColoredCirle();
	//showCurrentDistance();
	scoreClick++;
}
//------------------------------------------------------------------------------
function doInitGame()
{
	setTimeout("checkIsFound()", 200);
	
	// draw y elemOf ]0...1] from uniform dist
	// map to x elemOf ]0...range_max] using cdf(x): y = alpha * x + seed  
	// x = range_max ==> y = 1.0 
	// x = 0         ==> y = seed elemOf ]0...1]
	// alpha = ( 1 - seed ) / range_max
	// x =  ( y - seed ) * ( range_max / ( 1 -seed ) )  
	
	var aSeed = Date.now()/8640000000000000;
	while (aSeed<0.01) 
	{
		aSeed = aSeed*100.0;
	}
	while (aSeed>=1) 
	{
		aSeed = aSeed/10.0;
	}	
	var aRandomUniformNumber = Math.random();
	xOfTreas = Math.floor( ( aRandomUniformNumber - aSeed ) * ( 900.0 / ( 1.0 - aSeed ) ) );
	aRandomUniformNumber = Math.random();
	yOfTreas = Math.floor( ( aRandomUniformNumber - aSeed ) * ( 500.0 / ( 1.0 - aSeed ) ) );
	document.addEventListener('mousedown', customEventFunction );
}
//------------------------------------------------------------------------------
function checkIsFound()
{
	if (isFound>0)
	{
	// remove listener
	document.removeEventListener('mousedown', customEventFunction );
	// display win
	document.getElementById("mouseCoord_div").innerHTML = "You WON, SCORE: " + scoreClick;
	document.getElementById("mouseCoord_div").style = style_win;
	}
	setTimeout("checkIsFound()", 50);
}
//------------------------------------------------------------------------------
function mapContextToDistance(aRatioDist, aContext)
{
  // map context color to distance
  if ( aRatioDist > 0.5 )
  {
  aContext.fillStyle = "#0000FF";
  } else
  if ( aRatioDist > 0.25 )
  {
  aContext.fillStyle = "#00FF00";
  } else
  if ( aRatioDist > 0.125 )
  {
  aContext.fillStyle = "#FFBB00";
  } else
  if ( aRatioDist > 0.06 )
  {
  aContext.fillStyle = "#FF4400";
  }
  else
  {
  aContext.fillStyle = "#FF0000";
  }
} 
  
//------------------------------------------------------------------------------
function drawDistanceBasedColoredCirle()
{

//  -----> X
//  |
//  |
//  |
//  Y
  var canvas = document.getElementById('game_canvas');
  var context = canvas.getContext('2d');
  var centerX = xOfMouse;
  var centerY = yOfMouse;
  var radius = radiusOfSearch;
  
  // calculate distance from treasure
  var distanceToTreas = Math.sqrt( (xOfMouse-xOfTreas)*(xOfMouse-xOfTreas) + (yOfMouse-yOfTreas)*(yOfMouse-yOfTreas) );
  //currentDistance = "Current distance to treasure : " + distanceToTreas;

  //context.clearRect(0,0,canvas.width,canvas.height);
  context.beginPath();
  context.arc(centerX, centerY, radius, 0 , 2 * Math.PI, false);
  context.closePath();
 
  var maxDist = Math.sqrt( (900)*(500) + (900)*(500) );
  
  var ratioDist = distanceToTreas / maxDist;
  currentDistance = "Current distance ratio to treasure : " + ratioDist;
  // map to a suitable color
  mapContextToDistance(ratioDist, context);

  context.fill();
  
  if ( ratioDist < customThreshold )
  {
  	isFound = 1;
  }
  
}
</script>

<title>FIND THE TREASURE !</title>

</head>

<body id="BodyGame">
LEFT CLICK TO SEARCH inside the rectangle !
<div id="empty_div1"></div>
Blue: you are far! Green: Half way! 
<div id="empty_div2"></div>
Orange(s): closer and closer! Red: Burning close!
<div id="empty_div3"></div>

<div id="empty_div"></div>
<div id="mouseCoord_div"></div>
<div id="currentDistance_div"></div>
<canvas id="game_canvas" left="0" width="900" height="500" style="border:1px solid #000000;"></canvas>
<script>
doInitGame();
</script>

</body>

